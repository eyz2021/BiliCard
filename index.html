<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B站用户信息查询工具</title>
    <!-- 引入Tailwind CSS（无需本地安装，CDN加载） -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome图标（用于美化按钮/图标） -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义样式（B站粉色系主题） -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bili: {
                            pink: '#FB7299',    // B站主粉色
                            darkPink: '#DE557B',// 深色粉色
                            lightPink: '#FF9EBC'// 浅色粉色
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- 自定义工具类（hover动画、渐变色等） -->
    <style type="text/tailwindcss">
        @layer utilities {
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(251, 114, 153, 0.2);
            }
            .bg-bili-gradient {
                background: linear-gradient(135deg, #FB7299 0%, #DE557B 100%);
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8 px-4">
    <div class="max-w-2xl mx-auto">
        <!-- 页面标题 -->
        <div class="text-center mb-8">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-2">
                <i class="fa fa-play-circle text-bili-pink mr-2"></i>B站用户信息查询
            </h1>
            <p class="text-gray-600">输入用户UID，一键获取详细信息（如粉丝数、等级、头像等）</p>
        </div>
        
        <!-- 查询表单 -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-3">
                <input 
                    type="number" 
                    id="uidInput" 
                    placeholder="请输入B站用户UID（示例：616856644）"
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-bili-pink/50 focus:border-bili-pink"
                >
                <button 
                    id="queryBtn" 
                    class="bg-bili-gradient text-white px-6 py-3 rounded-lg font-medium hover:opacity-90 transition-opacity flex items-center justify-center"
                >
                    <i class="fa fa-search mr-2"></i>查询用户
                </button>
            </div>
            <p class="text-sm text-gray-500 mt-3">常见UID示例：2（B站官方）、1601721（李永乐）、616856644（测试用户）</p>
        </div>
        
        <!-- 加载状态（初始隐藏） -->
        <div id="loading" class="hidden text-center py-8 bg-white rounded-xl shadow-md">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-bili-pink"></div>
            <p class="mt-4 text-gray-600">正在获取用户信息...</p>
        </div>
        
        <!-- 错误提示（初始隐藏） -->
        <div id="error" class="hidden bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-xl shadow-md mb-8">
            <div class="flex items-center">
                <i class="fa fa-exclamation-circle text-xl mr-3"></i>
                <p id="errorMsg">获取信息失败，请检查UID是否正确</p>
            </div>
        </div>
        
        <!-- 用户信息卡片（初始隐藏） -->
        <div id="userCard" class="hidden bg-white rounded-xl shadow-md overflow-hidden card-hover mb-8">
            <!-- 卡片头部（渐变色背景） -->
            <div class="bg-bili-gradient p-6 relative">
                <!-- 头像（定位在头部下方，形成叠加效果） -->
                <div class="absolute -bottom-12 left-6 w-24 h-24 bg-white rounded-full border-4 border-white overflow-hidden">
                    <img id="userAvatar" src="" alt="用户头像" class="w-full h-full object-cover">
                </div>
            </div>
            
            <!-- 卡片内容（顶部预留头像空间） -->
            <div class="pt-16 px-6 pb-6">
                <!-- 基础信息（名字、等级、签名） -->
                <div class="mb-6 ml-2">
                    <div class="flex items-center gap-2 mb-1">
                        <h2 id="userName" class="text-2xl font-bold text-gray-800">加载中...</h2>
                        <span id="userLevel" class="bg-bili-pink text-white text-xs px-2 py-1 rounded-full">LV.0</span>
                    </div>
                    <p id="userSign" class="text-gray-600 text-sm">未设置签名</p>
                </div>
                
                <!-- 统计数据（粉丝数、关注数、投稿数、获赞数） -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-8">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p id="fansCount" class="text-xl font-bold text-bili-pink">0</p>
                        <p class="text-gray-500 text-xs mt-1">粉丝数</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p id="followCount" class="text-xl font-bold text-bili-pink">0</p>
                        <p class="text-gray-500 text-xs mt-1">关注数</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p id="videoCount" class="text-xl font-bold text-bili-pink">0</p>
                        <p class="text-gray-500 text-xs mt-1">投稿数</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <p id="likeCount" class="text-xl font-bold text-bili-pink">0</p>
                        <p class="text-gray-500 text-xs mt-1">获赞数</p>
                    </div>
                </div>
                
                <!-- 扩展信息（性别、会员状态、勋章） -->
                <div class="space-y-3 mb-6">
                    <div class="flex items-center text-gray-600 text-sm">
                        <i class="fa fa-venus-mars w-5 text-bili-pink"></i>
                        <span id="userSex">未知</span>
                    </div>
                    <div class="flex items-center text-gray-600 text-sm">
                        <i class="fa fa-diamond w-5 text-bili-pink"></i>
                        <span id="vipStatus">非会员</span>
                    </div>
                    <div class="flex items-center text-gray-600 text-sm">
                        <i class="fa fa-award w-5 text-bili-pink"></i>
                        <span id="userMedal">无勋章</span>
                    </div>
                </div>
                
                <!-- 跳转按钮（访问用户空间） -->
                <a 
                    id="spaceLink" 
                    href="" 
                    target="_blank" 
                    class="inline-flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors"
                >
                    <i class="fa fa-external-link"></i>
                    <span>访问B站空间</span>
                </a>
            </div>
        </div>
    </div>

    <!-- JavaScript逻辑（查询API、渲染数据） -->
    <script>
        // 1. 获取DOM元素
        const uidInput = document.getElementById('uidInput');
        const queryBtn = document.getElementById('queryBtn');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const errorMsg = document.getElementById('errorMsg');
        const userCard = document.getElementById('userCard');
        
        // 用户信息相关DOM
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userLevel = document.getElementById('userLevel');
        const userSign = document.getElementById('userSign');
        const fansCount = document.getElementById('fansCount');
        const followCount = document.getElementById('followCount');
        const videoCount = document.getElementById('videoCount');
        const likeCount = document.getElementById('likeCount');
        const userSex = document.getElementById('userSex');
        const vipStatus = document.getElementById('vipStatus');
        const userMedal = document.getElementById('userMedal');
        const spaceLink = document.getElementById('spaceLink');

        // 2. 绑定查询事件（按钮点击 + 回车键）
        queryBtn.addEventListener('click', queryUserInfo);
        uidInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') queryUserInfo();
        });

        // 3. 核心函数：查询B站用户信息
        async function queryUserInfo() {
            // 清空之前的状态
            resetState();
            
            // 获取并验证UID
            const uid = uidInput.value.trim();
            if (!uid || isNaN(uid)) {
                showError('请输入有效的数字UID（如616856644）');
                return;
            }
            
            // 显示加载状态
            showLoading();

            try {
                // 调用B站API（关键：使用CORS代理解决跨域问题）
                // 注意：生产环境建议自建后端代理，此处使用公开代理仅作演示
                const proxyUrl = 'https://corsproxy.io/'; 
                                
                const apiUrl = 'https://api.bilibili.com/x/web-interface/card';
                const response = await fetch(
                    `${proxyUrl}${apiUrl}?mid=${uid}&jsonp=jsonp&extra=true`,
                    {
                        method: 'GET',
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/126.0.0.0 Safari/537.36',
                            'Referer': 'https://www.bilibili.com/' // 模拟B站站内请求，降低拦截概率
                        }
                    }
                );

                // 解析API响应
                const result = await response.json();
                
                // 检查API返回状态（code=0表示成功）
                if (result.code !== 0) {
                    throw new Error(result.message || '获取用户信息失败，请检查UID是否存在');
                }

                // 提取用户数据（匹配之前的JSON结构）
                const data = result.data;
                const card = data.card;
                
                // 4. 渲染用户信息到页面
                renderUserInfo({
                    uid: card.mid,
                    name: card.name,
                    avatar: card.face,
                    
                    level: card.level_info.current_level,
                    sign: card.sign || '未设置签名',
                    sex: card.sex || '未知',
                    fans: card.fans || 0,
                    follow: card.attention || 0,
                    video: data.archive_count || 0,
                    like: data.like_num || 0,
                    vip: {
                        type: card.vip.type,
                        status: card.vip.status
                    },
                    medal: card.nameplate.name || '无勋章'
                });

                // 显示用户卡片
                showUserCard();

            } catch (err) {
                // 显示错误信息
                showError(err.message || '网络错误，请稍后重试');
            } finally {
                // 隐藏加载状态
                hideLoading();
            }
        }

        // 5. 辅助函数：渲染用户信息
        function renderUserInfo(user) {
                       // 在renderUserInfo函数中，将头像设置部分修改为：
            // 基础信息（重点修改头像URL，通过代理加载）
            const proxy = 'https://corsproxy.io/?'; // 使用CORS代理
            userAvatar.src = proxy + user.avatar; // 通过代理转发头像请求
            userAvatar.alt = `${user.name}的头像`;
            userName.textContent = user.name;
            userLevel.textContent = `LV.${user.level}`;
            userSign.textContent = user.sign;

            // 统计数据（格式化大数字：10000→1w，1000→1k）
            fansCount.textContent = formatNumber(user.fans);
            followCount.textContent = formatNumber(user.follow);
            videoCount.textContent = formatNumber(user.video);
            likeCount.textContent = formatNumber(user.like);
            
            // 扩展信息
            userSex.textContent = user.sex === '男' ? '男性' : user.sex === '女' ? '女性' : '未知';
            
            // 会员状态（status=1：有效会员；type=2：大会员）
            if (user.vip.status === 1) {
                vipStatus.innerHTML = user.vip.type === 2 
                    ? '<span class="text-orange-500 font-medium">大会员</span>' 
                    : '<span class="text-bili-pink font-medium">普通会员</span>';
            } else {
                vipStatus.textContent = '非会员';
            }
            
            userMedal.textContent = user.medal;
            
            // 跳转链接（B站空间）
            spaceLink.href = `https://space.bilibili.com/${user.uid}`;
        }

        // 6. 辅助函数：格式化数字（1000→1k，10000→1w）
        function formatNumber(num) {
            if (num >= 100000000) return (num / 100000000).toFixed(1) + '亿';
            if (num >= 10000) return (num / 10000).toFixed(1) + 'w';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        }

        // 7. 辅助函数：状态控制（显示/隐藏加载/错误/卡片）
        function resetState() {
            loading.classList.add('hidden');
            error.classList.add('hidden');
            userCard.classList.add('hidden');
        }

        function showLoading() {
            loading.classList.remove('hidden');
        }

        function hideLoading() {
            loading.classList.add('hidden');
        }

        function showError(msg) {
            errorMsg.textContent = msg;
            error.classList.remove('hidden');
        }

        function showUserCard() {
            userCard.classList.remove('hidden');
        }

        // 8. 初始化：默认填充示例UID
        uidInput.value = '616856644';
    </script>
</body>

</html>
